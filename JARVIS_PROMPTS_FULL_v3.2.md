# 📚 JARVIS v3.2 — Полная связка промптов и кнопок

**Дата:** 28 декабря 2025  
**Версия:** v3.2  
**Всего документов:** 8 (1 обязательный + 7 на выбор)

---

## 📊 Общая схема работы

```
┌─────────────────────────────────────────────────────────────┐
│  ПОЛЬЗОВАТЕЛЬ: Отправляет URL сайта компании                │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 0: Выбор цели встречи                                 │
│  Кнопки:                                                    │
│  • 🎯 Вводная/квалификация                                  │
│  • 🚀 Согласование пилота                                   │
│  • 💼 ТКП                                                   │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 1: Анализ компании (5-10 мин)                         │
│  Промпт: PROMPT_DOSSIER                                     │
│  Результат: 01_Досье_на_клиента.pdf ✅ ОБЯЗАТЕЛЬНО          │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 2: Меню выбора документов (7 документов)              │
│                                                             │
│  ☐ 02_Решения_BIMAR.xlsx        → PROMPT_USE_CASES         │
│  ☐ 03_Экономика_сделки.xlsx     → PROMPT_ROI               │
│  ☐ 04_Пилот_ТЗ.pdf              → PROMPT_SOW               │
│  ☐ 05_ЛПР_и_квалификация.xlsx   → PROMPT_STAKEHOLDERS      │
│  ☐ 06_Питч_для_клиента.pdf      → PROMPT_PRESENTATION      │
│  ☐ 08_Дашборд.pdf               → PROMPT_DASHBOARD 🆕      │
│  ☐ 07_Верификация.pdf           → PROMPT_VERIFICATION      │
│                                                             │
│  Управление:                                                │
│  • ✅ Выбрать все / ❌ Снять все                            │
│  • 🚀 Создать выбранные                                     │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  ЭТАП 3: Генерация выбранных документов                     │
│  Для КАЖДОГО документа — отдельный запрос в Manus API       │
│  Время: 2-3 мин/документ                                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 🗺️ Маппинг: Кнопка → Промпт → Файл

| № | Кнопка | Промпт | Выходной файл | Формат | База BIMAR |
|---|--------|--------|---------------|--------|------------|
| **1** | *(автоматически)* | `PROMPT_DOSSIER` | `01_Досье_на_клиента.pdf` | PDF | ✅ Да |
| **2** | ☐ Решения BIMAR | `PROMPT_USE_CASES` | `02_Решения_BIMAR.xlsx` | XLSX | ✅ Да |
| **3** | ☐ Экономика сделки | `PROMPT_ROI` | `03_Экономика_сделки.xlsx` | XLSX | ✅ Да |
| **4** | ☐ Пилот ТЗ | `PROMPT_SOW` | `04_Пилот_ТЗ.pdf` | PDF | ✅ Да |
| **5** | ☐ ЛПР и квалификация | `PROMPT_STAKEHOLDERS` | `05_ЛПР_и_квалификация.xlsx` | XLSX | ✅ Да |
| **6** | ☐ Питч для клиента | `PROMPT_PRESENTATION` | `06_Питч_для_клиента.pdf` | PDF | ✅ Да |
| **7** | ☐ Дашборд 📈 | `PROMPT_DASHBOARD` | `08_Дашборд.pdf` | PDF | ✅ Да |
| **8** | ☐ Верификация | `PROMPT_VERIFICATION` | `07_Верификация.pdf` | PDF | ✅ Да |

---

## 📚 База знаний BIMAR (используется во всех промптах)

Все промпты содержат секцию `{bimar_kb}` с явным указанием использовать:

```
БАЗА ЗНАНИЙ BIMAR (файлы проекта в Manus):
- BIMAR_SYSTEM_Единая_база_знаний_2025-10-14.docx
- BIMAR_Модульная_структура_продаж.md
- BIMAR_Стратегия_1млрд_долларов.md
- BIMAR-РФ.pptx / BIMAR-РФ.pdf
- BIMAR-Логистика_Склад_Порт_СИЗ.pptx
- BimAR_×_ОПТИКОМ__Пресейл-пакет.pdf
- SolidAR - Disaster Resilience rev4.pdf

ВАЖНО: Используй ТОЛЬКО информацию из этих файлов для описания 
продуктов, модулей, кейсов и возможностей BimAR.
```

---

## 🔍 Детальные промпты по документам

### 1️⃣ ДОСЬЕ КЛИЕНТА (обязательный)

**Промпт:** `PROMPT_DOSSIER`  
**Файл:** `01_Досье_на_клиента.pdf`  
**Время:** 5-10 минут

**Структура:**
1. Executive Summary (1 страница)
2. Портрет компании
3. Инвентарь активов и процессов
4. Потенциал для BimAR
5. Next Steps
6. Источники

**Ключевые требования:**
- Методология MEDDPICC
- Обязательное цитирование источников
- Пометка гипотез как "ГИПОТЕЗА"
- Фокус на закрытие сделки

---

### 2️⃣ РЕШЕНИЯ BIMAR

**Кнопка:** `☐ Решения BIMAR`  
**Промпт:** `PROMPT_USE_CASES`  
**Файл:** `02_Решения_BIMAR.xlsx`

**Структура таблицы:**
- Модуль BimAR
- Сценарий использования
- Боль клиента
- Решение
- Эффект
- Приоритет (высокий/средний/низкий)
- Сложность внедрения
- Срок реализации

**Источники данных:**
- База знаний BIMAR (модули и возможности)
- Досье клиента (боли и процессы)

---

### 3️⃣ ЭКОНОМИКА СДЕЛКИ

**Кнопка:** `☐ Экономика сделки`  
**Промпт:** `PROMPT_ROI`  
**Файл:** `03_Экономика_сделки.xlsx`

**Листы таблицы:**
1. **ROI калькулятор**
   - Текущие затраты
   - Затраты после внедрения
   - Экономия
   - ROI (%)
   - Срок окупаемости

2. **Стоимость пилота**
   - Лицензии
   - Внедрение
   - Обучение
   - Поддержка
   - Итого

3. **Timeline**
   - Этапы пилота (12 недель)
   - Контрольные точки

---

### 4️⃣ ПИЛОТ ТЗ

**Кнопка:** `☐ Пилот ТЗ`  
**Промпт:** `PROMPT_SOW`  
**Файл:** `04_Пилот_ТЗ.pdf`

**Структура:**
1. Цели пилота
2. Scope (что входит/не входит)
3. KPI успеха
4. Этапы (12 недель)
5. Роли и ответственность
6. Риски и митигация
7. Критерии принятия

---

### 5️⃣ ЛПР И КВАЛИФИКАЦИЯ

**Кнопка:** `☐ ЛПР и квалификация`  
**Промпт:** `PROMPT_STAKEHOLDERS`  
**Файл:** `05_ЛПР_и_квалификация.xlsx`

**Структура таблицы:**
- ФИО / Должность
- Роль (ЛПР / ЛВР / Пользователь)
- Влияние (1-10)
- Отношение (за / нейтрально / против)
- Боли и интересы
- Стратегия работы
- Статус контакта

**+ Лист MEDDPICC:**
- Metrics (метрики успеха)
- Economic Buyer (бюджет)
- Decision Criteria (критерии)
- Decision Process (процесс)
- Paper Process (документооборот)
- Identify Pain (боли)
- Champion (внутренний адвокат)
- Competition (конкуренты)

---

### 6️⃣ ПИТЧ ДЛЯ КЛИЕНТА

**Кнопка:** `☐ Питч для клиента`  
**Промпт:** `PROMPT_PRESENTATION`  
**Файл:** `06_Питч_для_клиента.pdf`

**Структура (10-12 страниц):**
1. Титульный слайд
2. О BimAR (1 слайд)
3. Ваши боли (2-3 слайда)
4. Наше решение (2-3 слайда)
5. Кейсы и референсы (1-2 слайда)
6. ROI и экономика (1 слайд)
7. Пилот (1 слайд)
8. Next Steps (1 слайд)

**Формат:** PDF с визуальным дизайном

---

### 7️⃣ ДАШБОРД 🆕

**Кнопка:** `☐ Дашборд` 📈  
**Промпт:** `PROMPT_DASHBOARD`  
**Файл:** `08_Дашборд.pdf`

**Структура (2-3 страницы):**

**Страница 1: Обзор решений**
1. Карта модулей BIMAR (диаграмма)
2. Топ-3 сценария (инфографика)
3. Матрица сложности внедрения

**Страница 2: Экономика**
4. ROI и окупаемость (графики)
5. Структура затрат пилота (круговая диаграмма)
6. Timeline внедрения (Gantt)

**Страница 3: Сравнение** (опционально)
7. До vs После BIMAR
8. Риски и митигация (heat map)

**Источники данных:**
- **ОБЯЗАТЕЛЬНО:** `02_Решения_BIMAR.xlsx`
- **ОБЯЗАТЕЛЬНО:** `03_Экономика_сделки.xlsx`
- Досье клиента

**Инструменты:** Python (matplotlib, seaborn, plotly) или Markdown с mermaid

---

### 8️⃣ ВЕРИФИКАЦИЯ

**Кнопка:** `☐ Верификация`  
**Промпт:** `PROMPT_VERIFICATION`  
**Файл:** `07_Верификация.pdf`

**Структура чек-листа:**
1. ✅ Информация о клиенте проверена
2. ✅ Боли подтверждены
3. ✅ ЛПР идентифицированы
4. ✅ Бюджет согласован
5. ✅ Timeline реалистичен
6. ✅ Конкуренты учтены
7. ✅ Риски оценены
8. ✅ Next Steps определены

**+ Список источников** с датами доступа

---

## 🔧 Техническая реализация

### Файлы проекта:

```
bimar_presale_bot/
├── bot.py                    # Основной файл бота
├── document_prompts.py       # Все промпты
├── document_types.py         # Описания документов (устарел)
├── generation_handlers.py    # Обработчики (устарел)
└── .env                      # Токены (не в git)
```

### Ключевые функции в bot.py:

```python
# Словарь всех документов
DOCUMENT_TYPES = {
    "dossier": {...},      # 01_Досье
    "use_cases": {...},    # 02_Решения
    "roi": {...},          # 03_Экономика
    "sow": {...},          # 04_Пилот_ТЗ
    "stakeholders": {...}, # 05_ЛПР
    "presentation": {...}, # 06_Питч
    "dashboard": {...},    # 08_Дашборд 🆕
    "verification": {...}  # 07_Верификация
}

# Создание задачи для одного документа
async def create_manus_task_single_doc(
    doc_id: str, 
    url: str, 
    goal: str, 
    constraints: str
) -> str:
    """Создаёт задачу в Manus API для одного документа"""
    prompt = get_document_prompt(doc_id, url, goal, constraints)
    # Отправка в Manus API...
    return task_id

# Генерация выбранных документов
async def process_selected_documents(
    message: Message, 
    state: FSMContext
):
    """Генерирует каждый выбранный документ отдельно"""
    for doc_id in selected_docs:
        task_id = await create_manus_task_single_doc(...)
        # Ожидание завершения...
        # Отправка файла пользователю...
```

### Функции в document_prompts.py:

```python
# Словарь всех промптов
DOCUMENT_PROMPTS = {
    "dossier": PROMPT_DOSSIER,
    "use_cases": PROMPT_USE_CASES,
    "roi": PROMPT_ROI,
    "sow": PROMPT_SOW,
    "stakeholders": PROMPT_STAKEHOLDERS,
    "presentation": PROMPT_PRESENTATION,
    "dashboard": PROMPT_DASHBOARD,  # 🆕
    "verification": PROMPT_VERIFICATION
}

# Получение промпта для документа
def get_document_prompt(
    doc_id: str, 
    url: str, 
    goal: str, 
    constraints: str = "-"
) -> str:
    """Возвращает готовый промпт с подставленными переменными"""
    template = DOCUMENT_PROMPTS[doc_id]
    return template.format(
        url=url,
        goal=goal,
        constraints=constraints,
        bimar_kb=BIMAR_KNOWLEDGE_BASE
    )
```

---

## 📝 Как редактировать промпты

### 1. Открыть файл:
```bash
nano /home/ubuntu/bimar_presale_bot/document_prompts.py
```

### 2. Найти нужный промпт:
```python
PROMPT_USE_CASES = """
═══════════════════════════════════════════════════════════════
ДОКУМЕНТ: 02_РЕШЕНИЯ_BIMAR.xlsx
═══════════════════════════════════════════════════════════════
...
"""
```

### 3. Изменить содержимое

### 4. Сохранить и запушить:
```bash
git add document_prompts.py
git commit -m "Обновлён промпт для [название документа]"
git push origin master
```

### 5. Railway автоматически перезапустит бота

---

## 🎯 Преимущества текущей архитектуры

✅ **Модульность:** Каждый документ — отдельный промпт  
✅ **Гарантия генерации:** Отдельный запрос для каждого документа  
✅ **База знаний:** Явное обращение к файлам BIMAR в каждом промпте  
✅ **Гибкость:** Пользователь выбирает только нужное  
✅ **Скорость:** Досье за 5-10 мин, остальное по запросу  
✅ **Качество:** Детальные структуры и требования в промптах  

---

## 📊 Статистика

- **Всего документов:** 8
- **Обязательных:** 1 (досье)
- **На выбор:** 7
- **Форматов:** PDF (5), XLSX (3)
- **Время генерации:** 5-10 мин (досье) + 2-3 мин/документ

---

**Последнее обновление:** 28 декабря 2025  
**Версия:** JARVIS v3.2
