#!/usr/bin/env python3
"""
Тестовый скрипт для симуляции гибридной выдачи документов JARVIS
Клиент: СтройИнвестХолдинг
"""

import os

VERSION = "3.0"

# Описания документов для гибридной выдачи
DOCUMENT_INFO = {
    "01_Досье_на_клиента": {
        "icon": "📋",
        "title": "Досье на клиента",
        "hint": "💡 Изучите перед встречей",
        "metrics": ["🏢 Профиль компании", "🎯 Точки входа", "👤 ЛПР выявлены", "⚠️ Ключевые боли"]
    },
    "02_Решения_BIMAR": {
        "icon": "🗺️",
        "title": "Решения BIMAR",
        "hint": "💡 Используйте на встрече",
        "metrics": ["📊 Сценарии использования", "⭐ Приоритетные", "🚀 Quick wins"]
    },
    "03_Экономика_сделки": {
        "icon": "💰",
        "title": "Экономика сделки",
        "hint": "💡 Ключевые цифры для переговоров",
        "metrics": ["💵 Экономия", "⏱️ Окупаемость", "📈 ROI"]
    },
    "04_Пилот_ТЗ": {
        "icon": "📝",
        "title": "Пилот ТЗ",
        "hint": "💡 Готово к согласованию",
        "metrics": ["🎯 Цели пилота", "📅 Длительность", "✅ KPI"]
    },
    "05_Лица_принимающие_решения": {
        "icon": "🎯",
        "title": "Лица принимающие решения",
        "hint": "💡 Стратегия работы внутри",
        "metrics": ["👤 Стейкхолдеры", "✅ ЛПР", "⚠️ Блокеры"]
    },
    "06_Питч_для_клиента": {
        "icon": "📊",
        "title": "Питч для клиента",
        "hint": "💡 Презентация для встречи",
        "metrics": ["📑 Слайдов: 10", "⏱️ Время: ~10 мин", "🎯 Экспресс-питч"]
    },
    "07_Верификация": {
        "icon": "📚",
        "title": "Верификация",
        "hint": "💡 Для проверки данных",
        "metrics": ["🔗 Источники", "📅 Дата сбора", "✅ Проверено"]
    }
}

def get_document_key(filename: str) -> str:
    """Извлекает ключ документа из имени файла"""
    for key in DOCUMENT_INFO.keys():
        if key in filename:
            return key
    return None

def msg_file_caption(filename: str) -> str:
    """Генерирует описание для файла в стиле JARVIS"""
    key = get_document_key(filename)
    if not key:
        return f"📎 {filename}"
    
    info = DOCUMENT_INFO[key]
    metrics_text = "\n".join([f"│ {m:<33} │" for m in info["metrics"]])
    
    return f"""{info['icon']} {info['title']}

┌─────────────────────────────────────┐
{metrics_text}
└─────────────────────────────────────┘

{info['hint']}"""

def msg_delivery_summary(domain: str, files_count: int, elapsed: str) -> str:
    """Генерирует компактное саммари перед выдачей файлов"""
    return f"""╔══════════════════════════════════════╗
║  📦 ПРЕСЕЙЛ-ПАКЕТ ГОТОВ             ║
║  {domain[:35]:<35} ║
╚══════════════════════════════════════╝

Сэр, миссия выполнена.
Доставляю {files_count} документов...

┌─ КЛЮЧЕВЫЕ МЕТРИКИ ──────────────────┐
│                                     │
│  📁 Документов:    {files_count:<16} │
│  ⏱️ Генерация:     {elapsed:<16} │
│  🎯 Клиент:        Проанализирован  │
│                                     │
└─────────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"""

def msg_delivery_complete(domain: str, files_count: int, elapsed: str) -> str:
    """Генерирует финальное сообщение после выдачи всех файлов"""
    return f"""━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

╔══════════════════════════════════════╗
║  ✅ ДОСТАВКА ЗАВЕРШЕНА              ║
╚══════════════════════════════════════╝

┌─────────────────────────────────────┐
│ 📁 Документов: {files_count:<20} │
│ ⏱️ Время генерации: {elapsed:<14} │
│ 🎯 Клиент: {domain[:24]:<24} │
└─────────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Удачи на встрече, сэр.
🤖 JARVIS v{VERSION} | BIMAR SYSTEM
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"""


# Тестовые данные
CLIENT = "СтройИнвестХолдинг"
DOMAIN = "stroyinvest.ru"
ELAPSED = "04:32"

# Список файлов
FILES = [
    "01_Досье_на_клиента.pdf",
    "02_Решения_BIMAR.xlsx",
    "03_Экономика_сделки.xlsx",
    "04_Пилот_ТЗ.docx",
    "05_Лица_принимающие_решения.xlsx",
    "06_Питч_для_клиента.pptx",
    "07_Верификация.md"
]

def main():
    print("=" * 60)
    print("🧪 ТЕСТ ГИБРИДНОЙ ВЫДАЧИ JARVIS")
    print(f"📋 Клиент: {CLIENT}")
    print("=" * 60)
    print()
    
    # 1. Компактное саммари
    print("━" * 60)
    print("📨 СООБЩЕНИЕ 1: КОМПАКТНОЕ САММАРИ")
    print("━" * 60)
    print(msg_delivery_summary(DOMAIN, len(FILES), ELAPSED))
    print()
    
    # 2. Последовательная выдача файлов
    for i, filename in enumerate(FILES, 1):
        print("━" * 60)
        print(f"📨 СООБЩЕНИЕ {i+1}: ФАЙЛ {i}/7")
        print("━" * 60)
        print(msg_file_caption(filename))
        print(f"\n📎 [Файл: {filename}]")
        print()
    
    # 3. Финальное сообщение
    print("━" * 60)
    print("📨 СООБЩЕНИЕ 9: ФИНАЛЬНОЕ")
    print("━" * 60)
    print(msg_delivery_complete(DOMAIN, len(FILES), ELAPSED))
    print()
    
    print("=" * 60)
    print("✅ ТЕСТ ЗАВЕРШЁН")
    print(f"📊 Всего сообщений: 9 (1 саммари + 7 файлов + 1 финал)")
    print("=" * 60)

if __name__ == "__main__":
    main()
